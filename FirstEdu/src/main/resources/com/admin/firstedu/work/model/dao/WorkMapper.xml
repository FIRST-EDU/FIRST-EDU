<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.admin.firstedu.work.model.dao.WorkMapper">

	<!-- resultMap -->
	<!-- 업무 보드 DTO -->
	<resultMap id="workBoardResultMap" type="WorkBoardDTO">
		<id column="BOARD_NO" property="boardNo"/>
		<result column="TITLE" property="title"/>
		<result column="CREATOR" property="creator"/>
	</resultMap>
	
	<!-- 선생님 DTO -->
	<resultMap id="teacherResultMap" type="TeacherDTO">
	    <id column="TEACHER_NO" property="no" />
	    <result column="JOB_CODE" property="jobCode" />
	    <result column="TEACHER_ID" property="id" />
	    <result column="TEACHER_PWD" property="pwd" />
	    <result column="TEACHER_NAME" property="name" />
	    <result column="TEACHER_EMAIL" property="email" />
	    <result column="TEACHER_GENDER" property="gender" />
	    <result column="TEACHER_PHONE" property="phone" />
	    <result column="TEACHER_ADDRESS" property="address" />
	    <result column="TEACHER_ROLE" property="role" />
	    <result column="HIRE_DATE" property="hireDate" />
	    <result column="ENT_DATE" property="endDate" />
	    <result column="TEACHER_STATUS" property="status" />
	</resultMap>
	
	<!-- 업무 보드 공유자 모든 정보 -->
	<resultMap id="WorkBoardMemberFullInfoResultMap" type="WorkBoardMemberFullInfoDTO">
		<result column="FAVORITE_YN" property="favoriteYn"/>
		<association resultMap="workBoardResultMap" property="board"/>
		<association resultMap="teacherResultMap" property="teacher"/>
	</resultMap>
	
	<!--  업무 보드 전체 정보 조회용 -->
	<resultMap id="workBoardFullInfoResultMap" type="WorkBoardFullInfoDTO">
		<id column="BOARD_NO" property="boardNo"/>
		<result column="TITLE" property="title"/>
		<result column="CREATOR" property="creator"/>
		<result column="IS_FAVORITE" property="isFavorite"/>
		<collection resultMap="WorkBoardMemberFullInfoResultMap" property="memberList"/>
	</resultMap>
	
	
	<!-- 쿼리문 -->
	<!-- 업무 보드 리스트 조회 -->
	<select id="selectWorkBoardList" parameterType="TeacherDTO" resultMap="workBoardFullInfoResultMap">
		SELECT
		       A.BOARD_NO
		     , A.TITLE
		     , A.CREATOR
		     , (SELECT D.FAVORITE_YN
		         FROM TBL_WORK_BOARD_MEMBER D
		        WHERE D.BOARD_NO = A.BOARD_NO
		          AND D.TEACHER_NO = #{ no }
		       ) AS IS_FAVORITE
		     , B.TEACHER_NO
		     , C.TEACHER_NAME
		  FROM TBL_WORK_BOARD A
		  JOIN TBL_WORK_BOARD_MEMBER B ON (A.BOARD_NO = B.BOARD_NO)
		  JOIN TBL_TEACHER C ON (B.TEACHER_NO = C.TEACHER_NO)
         WHERE A.BOARD_NO IN (SELECT A.BOARD_NO
                                FROM TBL_WORK_BOARD_MEMBER A
                               WHERE A.TEACHER_NO = #{ no }
                             )
         ORDER BY A.BOARD_NO
	</select>


</mapper>