<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.admin.firstedu.student.model.dao.StudentMapper">

	<!-- resultMap -->
	<!-- TBL_STUDENT DTO -->
	<resultMap id="studentResultMap" type="StudentDTO">
		<id column="STUDENT_NO" property="no"/>
		<result column="STUDENT_NAME" property="studentName"/>
		<result column="STUDENT_PHONE" property="studentPhone"/>
		<result column="PARENTS_NAME" property="parentsName"/>
		<result column="PARENTS_PHONE" property="parentsPhone"/>
		<result column="GENDER" property="gender"/>
		<result column="SCHOOL" property="school"/>
		<result column="ADDRESS" property="address"/>
		<result column="BIRTH" property="birth"/>
		<result column="REGISTRATION_DATE" property="registrationDate"/>
		<result column="QUIT_DATE" property="quitDate"/>
		<result column="STATUS" property="status"/>
		<result column="GRADE_CODE" property="gradeCode"/>
	</resultMap>
	
	<!-- 학년 테이블 DTO -->
	<resultMap id="gradeResultMap" type="GradeDTO">
		<id column="GRADE_CODE" property="code"/>
		<result column="GRADE_NAME" property="name"/>
	</resultMap>
	
	<!-- 재원생 목록 조회용 DTO -->
	<resultMap id="StudentRegistListResultMap" type="StudentRegistListDTO">
		<id column="STUDENT_NO" property="no"/>
		<result column="STUDENT_NAME" property="name"/>
		<result column="SCHOOL" property="school"/>
		<result column="GRADE_NAME" property="grade"/>
		<result column="STUDENT_PHONE" property="studentPhone"/>
		<result column="PARENTS_PHONE" property="parentsPhone"/>
		<result column="REGISTRATION_DATE" property="registrationDate"/>
	</resultMap>
	
	<!-- 학생별 수강 내역 조회용 -->	
	<resultMap id="StudentListClassNameResultMap" type="StudentListClassNameDTO">
		<result column="CLASS_NAME" property="name"/>
	</resultMap>
	
	<!-- 퇴원생 목록 조회용 DTO -->
	
	
	<!-- 학생 모든 정보 StudentFullInfoDTO -->
	<resultMap id="studentFullInfoResultMap" type="StudentFullInfoDTO">
		<id column="STUDENT_NO" property="no"/>
		<result column="STUDENT_NAME" property="studentName"/>
		<result column="STUDENT_PHONE" property="studentPhone"/>
		<result column="PARENTS_NAME" property="parentsName"/>
		<result column="PARENTS_PHONE" property="parentsPhone"/>
		<result column="GENDER" property="gender"/>
		<result column="SCHOOL" property="school"/>
		<result column="ADDRESS" property="address"/>
		<result column="BIRTH" property="birth"/>
		<result column="REGISTRATION_DATE" property="registrationDate"/>
		<result column="QUIT_DATE" property="quitDate"/>
		<result column="STATUS" property="status"/>
		<result column="GRADE_NAME" property="gradeName"/>
		<collection resultMap="studentClassInfoResultMap" property="classList"/>
	</resultMap>
	
	
	<!-- 쿼리 -->
	<!-- 학생 등록 -->
	<insert id="insertStudent" parameterType="StudentDTO">
		INSERT
		  INTO TBL_STUDENT A
		(
		  A.STUDENT_NO
		, A.STUDENT_NAME
		, A.STUDENT_PHONE
		, A.PARENTS_NAME
		, A.PARENTS_PHONE
		, A.GENDER
		, A.SCHOOL
		, A.ADDRESS
		, A.BIRTH
		, A.REGISTRATION_DATE
		, A.GRADE_CODE
		)
		VALUES
		(
		  SEQ_STUDENT_NO.NEXTVAL
		, #{ studentName }
		, #{ studentPhone, jdbcType=VARCHAR }
		, #{ parentsName, jdbcType=VARCHAR }
		, #{ parentsPhone, jdbcType=VARCHAR }
		, #{ gender, jdbcType=VARCHAR }
		, #{ school, jdbcType=VARCHAR }
		, #{ address, jdbcType=VARCHAR }
		, #{ birth, jdbcType=VARCHAR }
		, NVL(#{ registrationDate, jdbcType=DATE }, SYSDATE)
		, #{ gradeCode }
		)
	</insert>
	
	<!-- 재원생 목록 조회(+페이징 처리) -->
	<select id="selectTotalCount" resultType="_int">
		SELECT
		       COUNT(A.STUDENT_NO)
		  FROM TBL_STUDENT A
		 WHERE A.STATUS = 'Y'
	</select>
	<select id="selectStudentRegistList" resultMap="StudentRegistListResultMap">
		SELECT
	           A.RNUM	
		     , A.STUDENT_NO
		     , A.STUDENT_NAME
		     , A.SCHOOL
		     , A.GRADE_NAME
		     , A.STUDENT_PHONE
		     , A.PARENTS_PHONE
		     , A.REGISTRATION_DATE
		  FROM (SELECT ROWNUM RNUM
		             , B.STUDENT_NO
				     , B.STUDENT_NAME
				     , B.SCHOOL
				     , B.GRADE_NAME
				     , B.STUDENT_PHONE
				     , B.PARENTS_PHONE
				     , B.REGISTRATION_DATE
		          FROM (SELECT C.STUDENT_NO
						     , C.STUDENT_NAME
						     , C.SCHOOL
						     , D.GRADE_NAME
						     , C.STUDENT_PHONE
						     , C.PARENTS_PHONE
						     , C.REGISTRATION_DATE
						  FROM TBL_STUDENT C
						  JOIN TBL_GRADE D ON (C.GRADE_CODE = D.GRADE_CODE)
						 WHERE C.STATUS = 'Y'
						 ORDER BY C.STUDENT_NO DESC
		               ) B	  
		  	   ) A
		 WHERE A.RNUM BETWEEN #{ startRow } AND #{ endRow }
	</select>
	<select id="selectStudentClassList" parameterType="_int" resultMap="StudentListClassNameResultMap">
		SELECT
		       B.CLASS_NAME
		  FROM TBL_CLASS_INFO A
		  JOIN TBL_CLASS B ON (A.CLASS_CODE = B.CLASS_CODE)
		 WHERE A.STUDENT_NO = #{ studentNo }
	</select>
	
	
</mapper>