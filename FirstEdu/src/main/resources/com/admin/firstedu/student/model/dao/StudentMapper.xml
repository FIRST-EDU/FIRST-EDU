<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.admin.firstedu.student.model.dao.StudentMapper">

	<!-- resultMap -->
	<!-- TBL_STUDENT DTO -->
	<resultMap id="studentResultMap" type="StudentDTO">
		<id column="STUDENT_NO" property="no"/>
		<result column="STUDENT_NAME" property="studentName"/>
		<result column="STUDENT_PHONE" property="studentPhone"/>
		<result column="PARENTS_NAME" property="parentsName"/>
		<result column="PARENTS_PHONE" property="parentsPhone"/>
		<result column="GENDER" property="gender"/>
		<result column="SCHOOL" property="school"/>
		<result column="ADDRESS" property="address"/>
		<result column="BIRTH" property="birth"/>
		<result column="REGISTRATION_DATE" property="registrationDate"/>
		<result column="QUIT_DATE" property="quitDate"/>
		<result column="STATUS" property="status"/>
		<result column="GRADE_CODE" property="gradeCode"/>
	</resultMap>
	
	<!-- 학년 테이블 DTO -->
	<resultMap id="gradeResultMap" type="GradeDTO">
		<id column="GRADE_CODE" property="code"/>
		<result column="GRADE_NAME" property="name"/>
	</resultMap>
	
	<!-- 재원생 목록 조회용 DTO -->
	<resultMap id="StudentRegistListResultMap" type="StudentRegistListDTO">
		<id column="STUDENT_NO" property="no"/>
		<result column="STUDENT_NAME" property="name"/>
		<result column="SCHOOL" property="school"/>
		<result column="GRADE_NAME" property="grade"/>
		<result column="STUDENT_PHONE" property="studentPhone"/>
		<result column="PARENTS_PHONE" property="parentsPhone"/>
		<result column="REGISTRATION_DATE" property="registrationDate"/>
		<collection property="classList" ofType="com.admin.firstedu.student.model.dto.StudentListClassNameDTO">
			<result column="CLASS_NAME" property="name"/>
		</collection>
	</resultMap>
	
	<!-- 퇴원생 목록 조회용 DTO -->
	
	
	<!-- 학생 모든 정보 StudentFullInfoDTO -->
	<resultMap id="studentFullInfoResultMap" type="StudentFullInfoDTO">
		<id column="STUDENT_NO" property="no"/>
		<result column="STUDENT_NAME" property="studentName"/>
		<result column="STUDENT_PHONE" property="studentPhone"/>
		<result column="PARENTS_NAME" property="parentsName"/>
		<result column="PARENTS_PHONE" property="parentsPhone"/>
		<result column="GENDER" property="gender"/>
		<result column="SCHOOL" property="school"/>
		<result column="ADDRESS" property="address"/>
		<result column="BIRTH" property="birth"/>
		<result column="REGISTRATION_DATE" property="registrationDate"/>
		<result column="QUIT_DATE" property="quitDate"/>
		<result column="STATUS" property="status"/>
		<result column="GRADE_NAME" property="gradeName"/>
		<collection resultMap="studentClassInfoResultMap" property="classList"/>
	</resultMap>
	
	
	<!-- 쿼리 -->
	<!-- 학생 등록 -->
	<insert id="insertStudent" parameterType="StudentDTO">
		INSERT
		  INTO TBL_STUDENT A
		(
		  A.STUDENT_NO
		, A.STUDENT_NAME
		, A.STUDENT_PHONE
		, A.PARENTS_NAME
		, A.PARENTS_PHONE
		, A.GENDER
		, A.SCHOOL
		, A.ADDRESS
		, A.BIRTH
		, A.REGISTRATION_DATE
		, A.GRADE_CODE
		)
		VALUES
		(
		  SEQ_STUDENT_NO.NEXTVAL
		, #{ studentName }
		, #{ studentPhone, jdbcType=VARCHAR }
		, #{ parentsName, jdbcType=VARCHAR }
		, #{ parentsPhone, jdbcType=VARCHAR }
		, #{ gender, jdbcType=VARCHAR }
		, #{ school, jdbcType=VARCHAR }
		, #{ address, jdbcType=VARCHAR }
		, #{ birth, jdbcType=VARCHAR }
		, NVL(#{ registrationDate, jdbcType=DATE }, SYSDATE)
		, #{ gradeCode }
		)
	</insert>
	
	<!-- 재원생 목록 조회 -->
	<select id="selectStudentRegistList" resultMap="StudentRegistListResultMap">
		SELECT
		       A.STUDENT_NO
		     , A.STUDENT_NAME
		     , A.SCHOOL
		     , B.GRADE_NAME
		     , A.STUDENT_PHONE
		     , A.PARENTS_PHONE
		     , A.REGISTRATION_DATE
		     , D.CLASS_NAME
		  FROM TBL_STUDENT A
		  JOIN TBL_GRADE B ON (A.GRADE_CODE = B.GRADE_CODE)
		  JOIN TBL_CLASS_INFO C ON (A.STUDENT_NO = C.STUDENT_NO)
		  JOIN TBL_CLASS D ON (C.CLASS_CODE = D.CLASS_CODE)
		 WHERE A.STATUS = 'Y'
		 ORDER BY A.STUDENT_NO DESC
	</select>
	
	
</mapper>